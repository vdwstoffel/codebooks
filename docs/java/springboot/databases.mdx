---
sidebar_label: "Databases"
sidebar_position: 4
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Databases

## Setting up a Database



```xml title="pom.xml"
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>

<!-- MYSQL -->
<dependency>
    <groupId>com.mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
    <scope>runtime</scope>
</dependency>

<!-- POSTGRESQL -->
<dependency>
    <groupId>org.postgresql</groupId>
    <artifactId>postgresql</artifactId>
    <scope>runtime</scope>
</dependency>      
```

```bash
.
├── CruddemoApplication.java
├── dao
│   ├── StudentDAOImpl.java
│   └── StudentDAO.java
└── entity
    └── Student.java
```


<Tabs>

<TabItem value="Add DB info">

```properties title="application.properties"
spring.datasource.url=jdbc:mysql://192.168.129.15:9998/student_tracker
spring.datasource.username=demo
spring.datasource.password=demo
```
</TabItem>

<TabItem value="Entity Class">

- `@Entity` annotation is used to define a JPA entity.
- `@Table` annotation is used to define the table name.
- `@Id` annotation is used to define the primary key.
- `@GeneratedValue` annotation is used to define the generation strategy for the primary key.
- `@Column` annotation is used to define the column name.

```java title="Student.java"
package com.learn.cruddemo.entity;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.Table;

@Entity
@Table(name="student")
public class Student {
    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    @Column(name="id")
    private int id;

    @Column(name="first_name")
    private String firstName;

    @Column(name="last_name")
    private String lastName;

    @Column(name="email")
    private String email;

    public Student() {
    }

    public Student(String firstName, String lastName, String email) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.email = email;
    }

    // getters and setters
}
```

</TabItem>


<TabItem value="Create Interface">

The DAO (Data Access Object) interface is used to define the methods that will be used to interact with the database.

```java title="StudentDAO.java"
public interface StudentDAO {
    public Student findById(int Id);
    public void save(Student theStudent);
}
```
</TabItem>

<TabItem value="Create Implementation">

The DAO implementation class is used to implement the methods defined in the DAO interface.

- `@Transactional` annotation is used to indicate that the method is transactional. Only needed when making updates, not when reading.


```java title="StudentDAOImpl.java"
package com.learn.cruddemo.dao;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;
// highlight-next-line
import org.springframework.transaction.annotation.Transactional;
// highlight-next-line
import jakarta.persistence.EntityManager;

import com.learn.cruddemo.entity.Student;


@Repository
public class StudentDAOImpl implements StudentDAO {

    private EntityManager entityManager;

    @Autowired
    public StudentDAOImpl(EntityManager entityManager) {
        this.entityManager = entityManager;
    }
    
    @Override
    @Transactional
    public void save(Student theStudent) {
        entityManager.persist(theStudent);       
    }

    @Override
    public Student findById(Integer Id) {
        Student student = entityManager.find(Student.class, Id);
        return student;
    }
}
```

</TabItem>

</Tabs>


## CRUD
### Create

```java title="StudentDAO.java"
public interface StudentDAO {
    public void createStudent(Student theStudent);
}
```

```java title="StudentDAOImpl.java"
@Override
@Transactional
public void createStudent(Student theStudent) {
    entityManager.persist(theStudent);
}
```

### Read

- Read One

```java title="StudentDAO.java"
public Student getStudent(int studentId);
```

```java title="StudentDAOImpl.java"
@Override
public Student getStudent(int studentId) {
    return entityManager.find(Student.class, studentId);
}
```

- Read All

JPQL (Java Persistence Query Language) is used to query the database. In the below example Student refers to the entity class name, not the table name. Similarly, the field names refer to the entity class field names not the column names.

```java title="StudentDAO.java"
public List<Student> getStudents();
```

```java title="StudentDAOImpl.java"
import jakarta.persistence.TypedQuery;
import java.util.List;

@Override
public List<Student> findAll() {
    TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student", Student.class);
    return theQuery.getResultList();
}
```

## Injecting query parameters

```java title="StudentDAO.java"
public List<Student> getStudents(String lastName);
```

The `:lastName` is a named parameter that will be replaced by the value passed to the `setParameter` method.

```java title="StudentDAOImpl.java"
@Override
public List<Student> getStudents(String lastName) {
    TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student s WHERE s.lastName=:lastName", Student.class);
    theQuery.setParameter("lastName", lastName);
    return theQuery.getResultList();
}
```