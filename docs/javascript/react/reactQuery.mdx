---
sidebar_label: React Query
sidebar_position: 6
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import TanstackApp from "@site/src/components/reactExamples/reactQuery/TanstackApp";

# React Query

[React Query](https://tanstack.com/query/v5/docs/framework/react/overview) makes fetching, caching, synchronizing and updating server state in your web applications a breeze.

```bash
npm i @tanstack/react-query
```

## Using Devtools

```bash
npm i @tanstack/react-query-devtools
```

```jsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";

import BasicReactQueryExample from "./BasicReactQueryExample";

const queryClient = new QueryClient();

export default function TanstackApp() {
  return (
    <QueryClientProvider client={queryClient}>
      <BasicReactQueryExample />
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
}
```

## Basic Fetch Example

<Tabs>

<TabItem value="BasicExample.jsx">

```jsx
import { useQuery } from "@tanstack/react-query";

import { getUsers } from "../helpers/fakeServer";

export default function BasicReactQueryExample() {
  const { isPending, error, data } = useQuery({
    queryKey: ["data"],
    queryFn: getUsers,
  });

  if (isPending) return <p>Loading...</p>;
  if (error)
    return (
      <p>
        Error: {error.status} - {error.message}
      </p>
    );

  return (
    <>
      <h1>Basic Setup</h1>
      {data.map((user) => (
        <p>
          {user.name}, {user.age}
        </p>
      ))}
    </>
  );
}
```

</TabItem>

<TabItem value="App.jsx">

```jsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

import BasicReactQueryExample from "./BasicReactQueryExample";

const queryClient = new QueryClient();

export default function TanstackApp() {
  return (
    <QueryClientProvider client={queryClient}>
      <BasicReactQueryExample />
    </QueryClientProvider>
  );
}
```

</TabItem>

</Tabs>


<TanstackApp app="BasicExample" />

## Passing Arguments to Queries

When a query depends on a variable, you should include it in the `queryKey`. This ensures that the query is re-fetched automatically when the variable changes. It's also a good practice to use the `enabled` option to prevent a query from running until it has all the required parameters.

<Tabs>
<TabItem value="Request.jsx">

```jsx
import { useQuery } from "@tanstack/react-query";
import { useState } from "react";

import { getUserById } from "../helpers/fakeServer";

export default function FetchUserById() {
  const [userId, setUserId] = useState(1);

  const { isPending, error, data } = useQuery({
    // highlight-start
    queryKey: ["user", userId],
    queryFn: () => getUserById(userId),
    enabled: !!userId,
    // highlight-end
  });

  if (isPending) return <p>Loading...</p>;
  if (error)
    return (
      <p>
        Error: {error.status} - {error.message}
      </p>
    );

  return (
    <>
      <h1>User Details</h1>
      <p>
        {data.name}, {data.age}
      </p>
      <button onClick={() => setUserId(userId + 1)}>Next User</button>
    </>
  );
}
```

</TabItem>
<TabItem value="App.jsx">

```jsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

import FetchUserById from "./FetchUserById";

const queryClient = new QueryClient();

export default function TanstackApp() {
  return (
    <QueryClientProvider client={queryClient}>
      <FetchUserById />
    </QueryClientProvider>
  );
}
```

</TabItem>
</Tabs>

<!-- <TanstackApp app="FetchUserById" /> -->

## Updating data with mutations

<Tabs>

<TabItem value="Mutations.jsx">

```jsx
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";

import { getUsers, addUser } from "../helpers/fakeServer";

export default function Mutations() {
  const queryClient = useQueryClient(); // get access to the queryClient

  const {
    isPending: isFetching,
    error,
    data,
  } = useQuery({
    queryKey: ["users"],
    queryFn: getUsers,
  });

  // Mutation Function
  // highlight-start
  const { isPending: isPosting, mutate } = useMutation({
    mutationFn: addUser,
    onSuccess: () => {
      // Invalidate and refetch
      queryClient.invalidateQueries({ queryKey: ["users"] });
    },
    onError: () => console.log(error),
  });
  // highlight-end

  // Check the status of the data loading
  if (isFetching) return <p>Loading...</p>;
  if (error)
    return (
      <p>
        Error: {error.status} - {error.message}
      </p>
    );

  return (
    <>
      <h1>Mutations</h1>
      <button
        disabled={isPosting}
        onClick={() => mutate({ name: "Doe", age: 101 })}
      >
        {isPosting ? "Loading" : "Post"}
      </button>
      <ul>
        {data.map((user) => (
          <li>{user.name}</li>
        ))}
      </ul>
    </>
  );
}
```

</TabItem>

<TabItem value="App.jsx">

```jsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";

import Mutations from "./Mutation";

const queryClient = new QueryClient();

export default function TanstackApp({ app }) {
  return (
    <>
      <QueryClientProvider client={queryClient}>
        <Mutations />
      </QueryClientProvider>
    </>
  );
}
```

</TabItem>

</Tabs>

<TanstackApp app="Mutations" />

## Passing multiple args to mutation

```jsx
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";

import { getUsers, addUserMultipleArgs } from "../helpers/fakeServer";

export default function MutationFnMultipleArgs() {
  const queryClient = useQueryClient(); // get access to the queryClient

  const {
    isPending: isFetching,
    error,
    data,
  } = useQuery({
    queryKey: ["users"],
    queryFn: getUsers,
  });

  // Mutation Function
  const { isPending: isPosting, mutate } = useMutation({
    // Pass multiple args as an object
    mutationFn: ({ name, age }) => addUserMultipleArgs(name, age),
    onSuccess: () => {
      // Invalidate and refetch
      queryClient.invalidateQueries({ queryKey: ["users"] });
    },
    onError: () => console.log(error),
  });

  // Check the status of the data loading
  if (isFetching) return <p>Loading...</p>;
  if (error)
    return (
      <p>
        Error: {error.status} - {error.message}
      </p>
    );

  return (
    <>
      <h1>Mutations Function with multiple args</h1>
      <button
        disabled={isPosting}
        onClick={() => mutate({ name: "hello", age: 101 })}
      >
        {isPosting ? "Loading" : "Post"}
      </button>
      <ul>
        {data.map((data) => (
          <li>
            {data.name}, {data.age}
          </li>
        ))}
      </ul>
    </>
  );
}
```

## Creating a query hook

<Tabs>

<TabItem value="useGetNames.js">

1. Creating the ReactQuery hook

```js
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";

import { getUsers, addUser } from "../helpers/fakeServer";

export function useGetNames() {
  const {
    isPending,
    error,
    data: names,
  } = useQuery({
    queryKey: ["users"],
    queryFn: getUsers,
  });

  return { isPending, error, names };
}

export function useAddName() {
  const queryClient = useQueryClient();

  const { isPending: isPosting, mutate: addNewName } = useMutation({
    mutationFn: addUser,
    onSuccess: () => {
      // Invalidate and refetch
      queryClient.invalidateQueries({ queryKey: ["users"] });
    },
    onError: () => console.log(error),
  });

  return { isPosting, addNewName };
}
```

</TabItem>

<TabItem value="QueryHook.jsx">

2. Consuming the hook

```jsx
import { useGetNames, useAddName } from "./useDetails";

export default function QueryHooks() {
  const { isPending, error, names } = useGetNames();
  const { isPosting, addNewName } = useAddName();

  if (isPending) return <p>Loading...</p>;
  if (error) return <p>{error.message}</p>;

  return (
    <>
      <h1>Query Hooks </h1>
      <button
        disabled={isPosting}
        onClick={() => addNewName({ name: "Hello", age: 101 })}
      >
        {isPosting ? "Loading" : "Post"}
      </button>
      {names.map((user) => (
        <p>
          {user.name} {user.age}
        </p>
      ))}
    </>
  );
}
```

</TabItem>

</Tabs>

## Creating a query hook with arguments

<Tabs>

<TabItem value="useUserById.js">

```js
import { useQuery } from "@tanstack/react-query";

import { getUserById } from "../helpers/fakeServer";

export function useUserById(userId) {
  const {
    isPending,
    error,
    data: user,
  } = useQuery({
    queryKey: ["user", userId],
    queryFn: () => getUserById(userId),
    enabled: !!userId,
  });

  return { isPending, error, user };
}
```

</TabItem>

<TabItem value="QueryHookWithArgs.jsx">

```jsx
import { useState } from "react";
import { useUserById } from "./useUserById";

export default function QueryHookWithArgs() {
  const [userId, setUserId] = useState(1);
  const { isPending, error, user } = useUserById(userId);

  if (isPending) return <p>Loading...</p>;
  if (error) return <p>{error.message}</p>;

  return (
    <>
      <h1>Query Hook with arguments</h1>
      <p>
        {user.name}, {user.age}
      </p>
      <button onClick={() => setUserId(userId + 1)}>Next User</button>
    </>
  );
}
```

</TabItem>

</Tabs>

## Dynamically Supplying Arguments to a Hook

<Tabs>

<TabItem value="useUserById.js">

```js
import { useQuery } from "@tanstack/react-query";

import { getUserById } from "../helpers/fakeServer";

export function useUserById(userId) {
  const {
    isPending,
    error,
    data: user,
  } = useQuery({
    queryKey: ["user", userId],
    queryFn: () => getUserById(userId),
    enabled: !!userId,
  });

  return { isPending, error, user };
}
```

</TabItem>

<TabItem value="UserDetails.jsx">

```jsx
import { useUserById } from "./useUserById";

export default function UserDetails({ userId }) {
  const { isPending, error, user } = useUserById(userId);

  if (isPending) return <p>Loading...</p>;
  if (error) return <p>{error.message}</p>;

  return (
    <div>
      <p>
        {user.name}, {user.age}
      </p>
    </div>
  );
}
```

</TabItem>

<TabItem value="App.jsx">

```jsx
import { useState } from "react";
import UserDetails from "./UserDetails";

export default function App() {
  const [userId, setUserId] = useState(1);

  return (
    <>
      <h1>User Details</h1>
      <UserDetails userId={userId} />
      <button onClick={() => setUserId(userId + 1)}>Next User</button>
    </>
  );
}
```

</TabItem>

</Tabs>
