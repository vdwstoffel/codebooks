---
sidebar_label: "Authentication"
sidebar_position: 8
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import BrowserWindow from "@site/src/components/BrowserWindow/BrowserWindow";

# Authentication

Implementing authentication in a React application is crucial for protecting routes and managing user sessions. This guide demonstrates how to set up a basic authentication flow using Redux Toolkit for state management and React Router for protected routes.

## Project Structure

Here is a typical file structure for handling authentication:

```bash
.
├── api/
│   └── userApi.js
├── features/
│   ├── auth/
│   │   ├── authSlice.js
│   │   ├── AuthWrapper.jsx
│   │   ├── LoginPage.jsx
│   │   └── SecretPage.jsx
├── App.jsx
├── main.jsx
└── store.js
```

## Authentication with Redux Toolkit

This example demonstrates how to build a complete authentication flow, including an API utility for making requests, a Redux slice for managing authentication state, and components for logging in, viewing protected content, and handling redirects.

### Examples

<Tabs>
  <TabItem value="userApi.js" label="api/userApi.js">
    This utility simulates API calls for logging in and fetching user details. In a real application, these functions would make actual HTTP requests.

    ```js
    // Simulating a login request
    export async function loginUser() {
      // In a real app, you would make a POST request to your server
      // For this example, we'll just set a token in localStorage
      localStorage.setItem("userToken", "your-auth-token");
    }

    // Simulating a request to get user details
    export async function getUserDetails() {
      const token = localStorage.getItem("userToken");
      if (!token) throw new Error("No token found");

      // In a real app, you would send the token to the server to get user info
      return { username: "exampleUser" };
    }
    ```
  </TabItem>

  <TabItem value="authSlice.js" label="features/auth/authSlice.js">
    The `authSlice` manages the user's authentication state, including whether they are logged in, their details, and loading/error states.

    ```js
    import { createAsyncThunk, createSlice } from "@reduxjs/toolkit";
    import { getUserDetails } from "../../api/userApi";

    const initialState = {
      isLoggedIn: false,
      userDetails: null,
      status: "idle", // 'idle' | 'loading' | 'succeeded' | 'failed'
      error: null,
    };

    export const authenticateUser = createAsyncThunk("auth/authenticateUser", async () => {
      const response = await getUserDetails();
      return response;
    });

    const authSlice = createSlice({
      name: "auth",
      initialState,
      reducers: {
        logout: (state) => {
          state.isLoggedIn = false;
          state.userDetails = null;
          localStorage.removeItem("userToken");
        },
      },
      extraReducers: (builder) => {
        builder
          .addCase(authenticateUser.pending, (state) => {
            state.status = "loading";
          })
          .addCase(authenticateUser.fulfilled, (state, action) => {
            state.status = "succeeded";
            state.isLoggedIn = true;
            state.userDetails = action.payload;
          })
          .addCase(authenticateUser.rejected, (state, action) => {
            state.status = "failed";
            state.error = action.error.message;
          });
      },
    });

    export const { logout } = authSlice.actions;
    export default authSlice.reducer;
    ```
  </TabItem>

  <TabItem value="store.js" label="store.js">
    The Redux store is configured to include the `auth` reducer.

    ```js
    import { configureStore } from "@reduxjs/toolkit";
    import authReducer from "./features/auth/authSlice";

    export default configureStore({
      reducer: {
        auth: authReducer,
      },
    });
    ```
  </TabItem>

  <TabItem value="AuthWrapper.jsx" label="features/auth/AuthWrapper.jsx">
    The `AuthWrapper` is a protected route component. It checks for a token and dispatches the `authenticateUser` action. If the user is not authenticated, it redirects them to the login page.

    ```jsx
    import { useEffect } from "react";
    import { useDispatch, useSelector } from "react-redux";
    import { useNavigate } from "react-router-dom";
    import { authenticateUser } from "./authSlice";

    export default function AuthWrapper({ children }) {
      const dispatch = useDispatch();
      const navigate = useNavigate();
      const { isLoggedIn, status } = useSelector((state) => state.auth);

      useEffect(() => {
        const token = localStorage.getItem("userToken");
        if (token && !isLoggedIn) {
          dispatch(authenticateUser());
        } else if (!token) {
          navigate("/login");
        }
      }, [dispatch, isLoggedIn, navigate]);

      if (status === "loading") return <p>Loading...</p>;

      return isLoggedIn ? children : null;
    }
    ```
  </TabItem>

  <TabItem value="LoginPage.jsx" label="features/auth/LoginPage.jsx">
    The `LoginPage` component provides a button to simulate logging in. After a successful login, it redirects the user to the home page.

    ```jsx
    import { useNavigate } from "react-router-dom";
    import { loginUser } from "../../api/userApi";

    export default function LoginPage() {
      const navigate = useNavigate();

      const handleLogin = async () => {
        await loginUser();
        navigate("/");
      };

      return (
        <div>
          <h1>Login Page</h1>
          <button onClick={handleLogin}>Log In</button>
        </div>
      );
    }
    ```
  </TabItem>

  <TabItem value="App.jsx" label="App.jsx">
    The main `App` component sets up the routes for the application, including the protected route for the secret page.

    ```jsx
    import { createBrowserRouter, RouterProvider, NavLink, Outlet } from "react-router-dom";
    import { useDispatch, useSelector } from "react-redux";
    import { logout } from "./features/auth/authSlice";
    import LoginPage from "./features/auth/LoginPage";
    import SecretPage from "./features/auth/SecretPage";
    import AuthWrapper from "./features/auth/AuthWrapper";

    function Root() {
      const { isLoggedIn, userDetails } = useSelector((state) => state.auth);
      const dispatch = useDispatch();

      return (
        <div>
          <nav>
            <NavLink to="/">Home</NavLink> | <NavLink to="/secret">Secret Page</NavLink>
            {isLoggedIn && (
              <>
                <span> | Welcome, {userDetails?.username}</span>
                <button onClick={() => dispatch(logout())} style={{ marginLeft: '10px' }}>Logout</button>
              </>
            )}
          </nav>
          <hr />
          <Outlet />
        </div>
      );
    }

    const router = createBrowserRouter([
      {
        path: "/",
        element: <Root />,
        children: [
          { index: true, element: <h1>Home Page</h1> },
          {
            path: "secret",
            element: (
              <AuthWrapper>
                <SecretPage />
              </AuthWrapper>
            ),
          },
        ],
      },
      { path: "/login", element: <LoginPage /> },
    ]);

    export default function App() {
      return <RouterProvider router={router} />;
    }
    ```
  </TabItem>
</Tabs>
